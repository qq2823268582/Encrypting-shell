# Encrypting-shell
for learning
## 1.加密壳项目概述

------

加密器M将源程序A进行加密，然后放入壳程序B中，得到一个加密过的程序C。

直接点击加密过的程序C，运行的是壳程序B的内容，因为A经过加密后存放在C里，所以在C中找不到A的内容。

解密器N从加密过的程序C中取出A的部分，进行解密，然后通过傀儡进程的技术使A运行。

本实验中需要准备源程序A、壳程序B（A、B可以是任意的X86EXE），我们需要自己编写加密器M、解密器N。



## 2.编写加密器M

------

步骤1：读取源程序A成为源文件缓存

步骤2：对源文件缓存进行加密

步骤3：读取壳程序B成为壳文件缓存

步骤4：对壳文件缓存新增一个节，并修改好PE头

步骤5：拷贝加密后的源文件缓存到壳文件缓存的新增节区

步骤6：将修改后的壳文件缓存存盘为新的文件C





## 3.编写解密器N

------

步骤1：读取加密过的程序C成为文件缓存

步骤2：申请新的缓存，拷贝文件缓存的最后一个节到新的缓存中

步骤3：对新的缓存进行解密

步骤4：将新的缓存拉伸成镜像缓存

步骤5：以挂起方式创建傀儡进程

步骤6：获取傀儡进程的主线程的上下文

步骤7：取消傀儡进程的内存映射

步骤8：在傀儡进程内申请内存，将镜像缓存复制进来

步骤9：修正傀儡进程的PEB的ImageBaseAddress

步骤10：修正傀儡进程主线程的上下文中的EAX

步骤11：恢复挂起的傀儡进程的主线程

步骤12：释放申请的文件缓存与镜像缓存

